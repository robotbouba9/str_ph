#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ØªØ´ØºÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯ Ø£ÙˆÙ„ÙŠ
"""

import os
import sys
from pathlib import Path

def create_directories():
    """Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"""
    directories = ['instance', 'uploads', 'cache', 'backups', 'logs']
    for directory in directories:
        Path(directory).mkdir(exist_ok=True)

def setup_env():
    """Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©"""
    if not Path('.env').exists():
        env_content = """# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
APP_ENV=development
SECRET_KEY=dev-secret-key-change-in-production
DATABASE_URL=sqlite:///instance/phone_store.db

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…
HOST=0.0.0.0
PORT=5000

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
DEBUG=true
"""
        with open('.env', 'w', encoding='utf-8') as f:
            f.write(env_content)
        print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env")

    check_python_version()
    check_virtual_env()
    if install_requirements():
        setup_env()
    if '--auto-commits' in sys.argv:
        print("âœ… Auto-commits activÃ©s")
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
    create_directories()
    print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©")
    
    # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
    setup_env()
    
    # ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    try:
        from app import app
        print("\nğŸŒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰: http://localhost:5000")
        print("ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: owner")
        print("ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Owner@123")
        print("ğŸ’¡ Ø²Ø± /init_database Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
        print("=" * 50)
        
        app.run(host='0.0.0.0', port=5000, debug=True)
        
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: {e}")
        sys.exit(1)

    check_python_version()
    check_virtual_env()
    if install_requirements():
        setup_env()
    if '--auto-commits' in sys.argv:
        print("âœ… Auto-commits activÃ©s")
        # Ajouter le code pour les auto-commits ici
    main()
