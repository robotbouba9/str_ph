#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ููู ุงูุชุดุบูู ุงูููุงุฆู ุงููุญุณู ูุจุฑูุงูุฌ ุฅุฏุงุฑุฉ ูุฎุฒูู ูุญู ุงูููุงุชู
Final Enhanced Run Script for Phone Store Inventory Management System
"""

import os
import sys
import webbrowser
import time
from threading import Timer
from app import app, db
from database import Category, Product, Supplier, Customer

def check_database():
    """ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅูุดุงุฆูุง ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ"""
    with app.app_context():
        try:
            # ุฅูุดุงุก ุงูุฌุฏุงูู ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
            db.create_all()
            
            # ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
            if Category.query.count() == 0:
                print("๐ฆ ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ...")
                
                # ุฅุถุงูุฉ ุงููุฆุงุช ุงูุฃุณุงุณูุฉ
                categories = [
                    Category(name='ููุงุชู ุฐููุฉ', description='ุงูููุงุชู ุงููุญูููุฉ ุงูุฐููุฉ ุจุฌููุน ุฃููุงุนูุง ููุงุฑูุงุชูุง'),
                    Category(name='ุณูุงุนุงุช', description='ุณูุงุนุงุช ุงูุฑุฃุณ ูุงูุฃุฐู ุงูุณูููุฉ ูุงููุงุณูููุฉ'),
                    Category(name='ูุงุจูุงุช ุงูุดุญู', description='ูุงุจูุงุช ุงูุดุญู ูุงูุจูุงูุงุช ุจุฌููุน ุงูุฃููุงุน'),
                    Category(name='ุดูุงุญู', description='ุดูุงุญู ุงูููุงุชู ูุงูุฃุฌูุฒุฉ ุงูุฅููุชุฑูููุฉ'),
                    Category(name='ุญุงูุธุงุช ูุฌุฑุงุจุงุช', description='ุญุงูุธุงุช ูุฌุฑุงุจุงุช ุงูููุงุชู ุงููุงููุฉ'),
                    Category(name='ุงูุณุณูุงุฑุงุช', description='ุงูุณุณูุงุฑุงุช ุงูููุงุชู ุงููุชููุนุฉ'),
                    Category(name='ุจุทุงุฑูุงุช ุฎุงุฑุฌูุฉ', description='ุจุทุงุฑูุงุช ุงูุดุญู ุงููุญูููุฉ ุจุณุนุงุช ูุฎุชููุฉ'),
                    Category(name='ุดุงุดุงุช ุญูุงูุฉ', description='ุดุงุดุงุช ุงูุญูุงูุฉ ุงูุฒุฌุงุฌูุฉ ูุงูุจูุงุณุชูููุฉ')
                ]
                
                for category in categories:
                    db.session.add(category)
                
                db.session.commit()
                print(f"โ ุชู ุฅุถุงูุฉ {len(categories)} ูุฆุงุช ุฃุณุงุณูุฉ")
            
            return True
            
        except Exception as e:
            print(f"โ ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: {e}")
            return False

def open_browser():
    """ูุชุญ ุงููุชุตูุญ ุชููุงุฆูุงู"""
    try:
        webbrowser.open('http://127.0.0.1:5000')
    except:
        pass

def print_banner():
    """ุทุจุงุนุฉ ุดุนุงุฑ ุงูุจุฑูุงูุฌ"""
    banner = """
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                              โ
โ    ๐ฑ ุจุฑูุงูุฌ ุฅุฏุงุฑุฉ ูุฎุฒูู ูุญู ุงูููุงุชู ุงููุญุณู ๐ฑ              โ
โ                                                              โ
โ    ๐ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:                                      โ
โ    โ ูุธุงู ุงููุฆุงุช ุงููุชูุฏู                                    โ
โ    โ ุงูุจุญุซ ุงูุชููุงุฆู ุงูุฐูู                                   โ
โ    โ ูุตู ููุตู ููููุชุฌุงุช                                     โ
โ    โ ุงูุฃุฑูุงู ุจุงูุชูุณูู ุงูุฅูุฌููุฒู                            โ
โ    โ ุชุตููู ูุญุณู ููุชูุงุณู                                    โ
โ                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
"""
    print(banner)

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ูุชุดุบูู ุงูุจุฑูุงูุฌ"""
    print_banner()
    
    print("๐ง ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
    if not check_database():
        print("โ ูุดู ูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช!")
        input("ุงุถุบุท Enter ููุฎุฑูุฌ...")
        return
    
    print("โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ!")
    print("\n๐ ุงูุจุฑูุงูุฌ ูุชุงุญ ุนูู:")
    print("   โข http://127.0.0.1:5000")
    print("   โข http://localhost:5000")
    
    print("\n๐ ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู...")
    print("๐ง ููุฅููุงู: ุงุถุบุท Ctrl+C")
    print("=" * 60)
    
    # ูุชุญ ุงููุชุตูุญ ุจุนุฏ 3 ุซูุงูู
    Timer(3.0, open_browser).start()
    
    try:
        # ุชุดุบูู ุงูุชุทุจูู
        app.run(
            debug=True,
            host='127.0.0.1',
            port=5000,
            use_reloader=True,
            threaded=True
        )
    except KeyboardInterrupt:
        print("\n\n๐ ุชู ุฅููุงู ุงูุจุฑูุงูุฌ ุจูุฌุงุญ!")
        print("ุดูุฑุงู ูุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ุฅุฏุงุฑุฉ ูุฎุฒูู ูุญู ุงูููุงุชู ุงููุญุณู!")
    except Exception as e:
        print(f"\nโ ุฎุทุฃ ูู ุชุดุบูู ุงูุจุฑูุงูุฌ: {e}")
        input("ุงุถุบุท Enter ููุฎุฑูุฌ...")

if __name__ == '__main__':
    main()