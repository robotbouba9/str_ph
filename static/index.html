<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8" />
    <title>AI Agent</title>
    <style>
        body {
            background: #121212;
            color: #eee;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        h1 {
            color: #4CAF50;
        }

        #chat {
            width: 80%;
            max-width: 600px;
            height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .user {
            color: #4FC3F7;
            margin: 5px 0;
        }

        .bot {
            color: #81C784;
            margin: 5px 0;
        }

        input {
            width: 70%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            margin-right: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }

        .controls {
            margin-bottom: 20px;
        }

        .tab-btn {
            margin-right: 10px;
            background: #333;
            color: #eee;
        }

        .tab-btn.active {
            background: #4CAF50;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .analyze-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        #analysis-type {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #333;
            background: #1e1e1e;
            color: #eee;
        }

        #file-input {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #333;
            background: #1e1e1e;
            color: #eee;
        }

        #code-input {
            width: 100%;
            height: 200px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
            background: #1e1e1e;
            color: #eee;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
            resize: vertical;
        }

        #analysis-result {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: Arial, sans-serif;
        }

        .analysis {
            color: #FFD700;
            margin: 5px 0;
        }

        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª */
        .files-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        #current-path {
            color: #4CAF50;
            font-weight: bold;
        }

        .files-container {
            display: flex;
            gap: 10px;
            height: 500px;
        }

        .files-list {
            width: 300px;
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
        }

        .file-item {
            padding: 8px;
            margin: 2px 0;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item:hover {
            background: #333;
        }

        .file-item.selected {
            background: #4CAF50;
        }

        .file-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #333;
            border-radius: 5px 5px 0 0;
        }

        #editor-file-name {
            color: #4CAF50;
            font-weight: bold;
        }

        #file-content {
            flex: 1;
            padding: 10px;
            border: 1px solid #333;
            border-top: none;
            border-radius: 0 0 5px 5px;
            background: #1e1e1e;
            color: #eee;
            font-family: 'Courier New', monospace;
            resize: none;
        }

        /* Terminal */
        .terminal-output {
            height: 400px;
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            color: #0f0;
            margin-bottom: 10px;
        }

        .terminal-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .prompt {
            color: #4CAF50;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        #terminal-command {
            flex: 1;
            background: #000;
            color: #0f0;
            border: 1px solid #333;
            font-family: 'Courier New', monospace;
        }

        .terminal-line {
            margin: 2px 0;
        }

        .terminal-command {
            color: #4CAF50;
        }

        .terminal-output-text {
            color: #eee;
        }

        .terminal-error {
            color: #f44336;
        }
    </style>
</head>

<body>
    <h1>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø°ÙƒÙŠ</h1>
    <div class="controls">
        <button onclick="showTab('chat')" class="tab-btn active" id="chat-tab">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</button>
        <button onclick="showTab('analyze')" class="tab-btn" id="analyze-tab">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
        <button onclick="showTab('files')" class="tab-btn" id="files-tab">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</button>
        <button onclick="showTab('terminal')" class="tab-btn" id="terminal-tab">ğŸ’» Terminal</button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
    <div id="chat-section" class="section active">
        <div id="chat"></div>
        <div class="input-group">
            <input id="message" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹..." />
            <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ -->
    <div id="analyze-section" class="section">
        <div class="analyze-controls">
            <select id="analysis-type">
                <option value="general">ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù…</option>
                <option value="security">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù…Ù†ÙŠØ©</option>
                <option value="performance">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</option>
                <option value="structure">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨Ù†ÙŠØ©</option>
            </select>
            <input type="file" id="file-input" accept=".py,.js,.html,.css" />
            <button onclick="analyzeCode()">ØªØ­Ù„ÙŠÙ„</button>
        </div>
        <textarea id="code-input" placeholder="Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ù„Ù„ØªØ­Ù„ÙŠÙ„..."></textarea>
        <div id="analysis-result"></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <div id="files-section" class="section">
        <div class="files-controls">
            <button onclick="loadFiles()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            <button onclick="createNewFile()">ğŸ“„ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</button>
            <span id="current-path">ğŸ“‚ /</span>
        </div>
        <div class="files-container">
            <div id="files-list" class="files-list"></div>
            <div id="file-editor" class="file-editor">
                <div class="editor-header">
                    <span id="editor-file-name">Ø§Ø®ØªØ± Ù…Ù„Ù Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</span>
                    <button onclick="saveCurrentFile()" id="save-btn" disabled>ğŸ’¾ Ø­ÙØ¸</button>
                </div>
                <textarea id="file-content" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>
            </div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Terminal -->
    <div id="terminal-section" class="section">
        <div id="terminal-output" class="terminal-output"></div>
        <div class="terminal-input">
            <span class="prompt">$</span>
            <input id="terminal-command" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ù…Ø± Ù‡Ù†Ø§..." />
            <button onclick="executeCommand()">ØªÙ†ÙÙŠØ°</button>
        </div>
    </div>

    <script>
        async function sendMessage() {
            const msgBox = document.getElementById("message");
            const chatBox = document.getElementById("chat");
            const userMessage = msgBox.value.trim();
            if (!userMessage) return;

            // Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            chatBox.innerHTML += `<div class="user">ğŸ‘¤: ${userMessage}</div>`;
            msgBox.value = "";

            try {
                const res = await fetch("http://localhost:8000/ask", {   // â¬…ï¸ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Groq Ø§Ù„Ù…Ù†ÙØµÙ„
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userMessage })
                });

                const data = await res.json();
                chatBox.innerHTML += `<div class="bot">ğŸ¤–: ${data.reply}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;

            } catch (err) {
                chatBox.innerHTML += `<div class="bot">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>`;
            }
        }

        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName + '-section').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        async function analyzeCode() {
            const analysisType = document.getElementById('analysis-type').value;
            const codeInput = document.getElementById('code-input').value;
            const fileInput = document.getElementById('file-input').files[0];
            const resultDiv = document.getElementById('analysis-result');

            let codeContent = codeInput;

            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
            if (fileInput && !codeContent) {
                try {
                    codeContent = await readFile(fileInput);
                } catch (err) {
                    resultDiv.innerHTML = `<div class="analysis">âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ${err.message}</div>`;
                    return;
                }
            }

            if (!codeContent) {
                resultDiv.innerHTML = `<div class="analysis">âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„ØªØ­Ù„ÙŠÙ„</div>`;
                return;
            }

            resultDiv.innerHTML = `<div class="analysis">ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯...</div>`;

            try {
                const response = await fetch("http://localhost:8000/analyze", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        code: codeContent,
                        type: analysisType,
                        file_path: fileInput ? fileInput.name : ""
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `<div class="analysis">ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ (${getAnalysisTypeName(analysisType)}):</div>
                                         <div style="color: #eee; margin-top: 10px;">${data.analysis}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="analysis">âŒ ${data.reply || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„'}</div>`;
                }

            } catch (err) {
                resultDiv.innerHTML = `<div class="analysis">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>`;
            }
        }

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                reader.readAsText(file);
            });
        }

        function getAnalysisTypeName(type) {
            const names = {
                'general': 'ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù…',
                'security': 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù…Ù†ÙŠØ©',
                'performance': 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡',
                'structure': 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨Ù†ÙŠØ©'
            };
            return names[type] || 'ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù…';
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentDirectory = "";
        let currentFile = "";
        let files = [];

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
        async function loadFiles(directory = "") {
            try {
                const response = await fetch(`http://localhost:8000/files?dir=${directory}`);
                const data = await response.json();

                if (response.ok) {
                    files = data.files;
                    currentDirectory = data.directory;
                    displayFiles();
                    document.getElementById('current-path').textContent = `ğŸ“‚ /${currentDirectory}`;
                } else {
                    alert(`Ø®Ø·Ø£: ${data.error}`);
                }
            } catch (err) {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª');
            }
        }

        function displayFiles() {
            const filesList = document.getElementById('files-list');
            filesList.innerHTML = '';

            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø£Ø¨
            if (currentDirectory) {
                const backItem = document.createElement('div');
                backItem.className = 'file-item';
                backItem.innerHTML = 'ğŸ“ ..';
                backItem.onclick = () => {
                    const parentDir = currentDirectory.split('/').slice(0, -1).join('/');
                    loadFiles(parentDir);
                };
                filesList.appendChild(backItem);
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `${file.type === 'directory' ? 'ğŸ“' : 'ğŸ“„'} ${file.name}`;

                fileItem.onclick = () => {
                    if (file.type === 'directory') {
                        loadFiles(file.path);
                    } else {
                        selectFile(file);
                    }
                };

                filesList.appendChild(fileItem);
            });
        }

        async function selectFile(file) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('selected');
            });

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
            event.target.classList.add('selected');
            currentFile = file.path;

            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù
            try {
                const response = await fetch(`http://localhost:8000/file?path=${file.path}`);
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('file-content').value = data.content;
                    document.getElementById('editor-file-name').textContent = file.name;
                    document.getElementById('save-btn').disabled = false;
                } else {
                    alert(`Ø®Ø·Ø£: ${data.error}`);
                }
            } catch (err) {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
            }
        }

        async function saveCurrentFile() {
            if (!currentFile) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø­Ø¯Ø¯');
                return;
            }

            const content = document.getElementById('file-content').value;

            try {
                const response = await fetch('http://localhost:8000/file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        path: currentFile,
                        content: content
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(`âœ… ${data.message}`);
                } else {
                    alert(`âŒ ${data.error}`);
                }
            } catch (err) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù');
            }
        }

        function createNewFile() {
            const fileName = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
            if (!fileName) return;

            const filePath = currentDirectory ? `${currentDirectory}/${fileName}` : fileName;
            currentFile = filePath;

            document.getElementById('file-content').value = '';
            document.getElementById('editor-file-name').textContent = fileName;
            document.getElementById('save-btn').disabled = false;
        }

        // Terminal
        async function executeCommand() {
            const commandInput = document.getElementById('terminal-command');
            const command = commandInput.value.trim();

            if (!command) return;

            const terminalOutput = document.getElementById('terminal-output');

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù…Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª
            terminalOutput.innerHTML += `<div class="terminal-line terminal-command">$ ${command}</div>`;
            commandInput.value = '';

            try {
                const response = await fetch('http://localhost:8000/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command: command })
                });

                const data = await response.json();

                if (data.success) {
                    if (data.output) {
                        terminalOutput.innerHTML += `<div class="terminal-line terminal-output-text">${data.output}</div>`;
                    }
                } else {
                    terminalOutput.innerHTML += `<div class="terminal-line terminal-error">âŒ ${data.error}</div>`;
                }

                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
                terminalOutput.scrollTop = terminalOutput.scrollHeight;

            } catch (err) {
                terminalOutput.innerHTML += `<div class="terminal-line terminal-error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>`;
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
        }

        // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('message').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        document.getElementById('terminal-command').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                executeCommand();
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.getElementById('files-tab').addEventListener('click', function () {
            if (files.length === 0) {
                loadFiles();
            }
        });
    </script>
</body>

</html>